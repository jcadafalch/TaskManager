@using GestorTareas.Client.Components.Etiqueta

@*background-color:{Colors.BlueGrey.Lighten2};*@
<MudCard Elevation="3" Style=@($"background-color: var(--mud-palette-table-lines); width: 100%; height: 100%")>
    <MudCardHeader Class="pt-2">
        <CardHeaderContent>
            <MudText Typo="Typo.h6">@Tarea.Title</MudText>
            <MudText Typo="Typo.caption">@Tarea.CreatedAt</MudText>

            @*Si estamos en la página home, mostramos un chip con el estado de la tarea*@
            @if (All)
            {
                <br />
                <MudChip Variant="Variant.Text" Size="Size.Small" Color="@(TareaStatus ? Color.Success : Color.Error)">@(TareaStatus ? "Completada" : "Pendiente")</MudChip>
            }
        </CardHeaderContent>
        <CardHeaderActions>

            @*Si estamos en la página home, mostramos un menu de opciones*@
            @if (All)
            {
                <MudMenu Icon="@Icons.Filled.Settings" Class="pt-1" Size="Size.Small" ActivationEvent="@MouseEvent.MouseOver" AnchorOrigin="Origin.BottomCenter" TransformOrigin="Origin.TopCenter">
                    <ChildContent>
                        <MudMenuItem OnClick="@OnChangeStatus">@(TareaStatus ? "Marcar como pendiente" : "Completar")</MudMenuItem>
                        <MudMenuItem OnClick="@ModifyTarea">Modificar</MudMenuItem>
                        <MudMenuItem OnClick="@DeleteTareaAsync">Eliminar</MudMenuItem>
                    </ChildContent>
                </MudMenu>
            }
            @*Sino, mostramos un checkbox con el estado de la tarea*@
            else
            {
                <MudCheckBox T="bool" Checked="@TareaStatus" Color="@(TareaStatus ? Color.Success : Color.Secondary)" CheckedChanged="CheckBoxChanged" Disabled="!All && !Modify && !Delete ? false : true" />
            }

        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent Class="mt-n8 pl-2 ps-2 pr pe">
        <MudDivider Light Class="mb-1" />
        <MudText Class="py-3">@Tarea.Content</MudText>

        @*Si estamos en la página home, mostramos todas las etiquetas que tiene la tarea y un chip para añadir etiquetas a la tarea*@
        @if (All)
        {
            <MudDivider Light Class="mb-3" />
            <MudChip Style="padding-right: 6px;" Color="Color.Info" OnClick="AddEtiquetaToTarea" Size="Size.Small" Icon="@Icons.Filled.Add" />
            @if (Tarea.Etiquetas is not null && Tarea.Etiquetas.Any())
            {
                @foreach (var etiqueta in Tarea.Etiquetas)
                {
                    <MudChip Color="Color.Surface" OnClose="RemoveEtiquetaToTarea" Size="Size.Small" Tag="@etiqueta">@etiqueta.Name</MudChip>
                }
            }
        }
    </MudCardContent>
    @*Si estamos en la página de eliminar o modificar una tarea, mostramos un botón para realizar esas acciones.*@
    @if (Delete || Modify)
    {
        <MudCardActions>
            @if (Modify)
            {
                <MudButton Variant="Variant.Text" Color="Color.Warning" OnClick="@ModifyTarea">Editar</MudButton>
            }

            @if (Delete)
            {
                <MudButton OnClick="DeleteTareaAsync" Variant="Variant.Filled" Color="Color.Error">Delete Tarea</MudButton>
            }
        </MudCardActions>
    }

</MudCard>